# Windows 环境端到端测试清单（Layer 3.5）

> 目标：在 Windows 上验证“打包产物 + UI + 热键录音 + 服务端推理 + 文本注入 + 日志落盘”的完整链路。
>
> 建议测试环境：Windows 10/11（管理员账号），有可用麦克风设备。

## 0. 准备工作

- [ ] 已拿到服务端打包产物（`GhostTypeServer.exe` 或同等入口）
- [ ] 已拿到客户端打包产物（`GhostType.exe` 或同等入口）
- [ ] 服务端目录下存在模型：`models/sensevoice-small.onnx`
- [ ] 同机测试或局域网互通（防火墙允许 8000 端口）

可选（日志落盘验证）：
- [ ] 为客户端设置环境变量：`GHOSTTYPE_LOG_FILE=1`
  - PowerShell（当前终端生效）：`$env:GHOSTTYPE_LOG_FILE="1"`
  - 或系统环境变量（永久）：`setx GHOSTTYPE_LOG_FILE 1`

## 1. 服务端 GUI（双击启动）

- [ ] 双击启动服务端后出现 GUI 窗口（包含：状态 / 设置 / 日志）
- [ ] 默认状态显示为“启动中”，随后变为“运行中”
- [ ] 设置面板可编辑：
  - [ ] 绑定地址（`0.0.0.0` / `127.0.0.1`）
  - [ ] 绑定端口（默认 8000）
  - [ ] 日志级别（`DEBUG/INFO/WARNING/ERROR`）
- [ ] 点击“保存并重启服务”后：
  - [ ] 子进程被重启（日志可见停止/启动信息）
  - [ ] 状态面板地址端口同步更新
  - [ ] `config.json` 写入到服务端 exe 同级目录（源码模式为 `server/config.json`）

状态解析（需要客户端连接/说话后验证）：
- [ ] 连接数能随客户端连接/断开更新
- [ ] 模型 / Provider 能在日志出现 “ASR model loaded” 后展示
- [ ] 最近一次 ASR 耗时能随 “ASR inference completed” 更新

## 2. 客户端 UI（托盘 + 设置窗口）

- [ ] 启动客户端后托盘区出现 GhostType 图标
- [ ] 右键托盘菜单：
  - [ ] `Show` 打开设置窗口
  - [ ] `Hide` 隐藏设置窗口
  - [ ] `Quit` 正常退出

权限/设备引导：
- [ ] 若麦克风不可用，窗口会自动弹出权限/设备引导卡片
- [ ] 引导卡片内可看到“检测到的输入设备”列表
- [ ] 点击“打开系统设置”能打开 Windows 声音设置（`ms-settings:sound`）
- [ ] 点击“刷新状态”能重新检测并更新状态

设置项：
- [ ] 服务器地址可编辑（例如：`ws://127.0.0.1:8000/ws`）
- [ ] “测试连接”能正确显示已连接/未连接
- [ ] 可选择音频输入设备（默认设备 / 指定设备）
- [ ] 点击“保存配置”成功写入 `config.json`

## 3. 端到端录音与注入

- [ ] 打开记事本/VS Code 等可输入窗口并聚焦光标
- [ ] 按住热键说“测试”，松开
- [ ] 服务端日志可见：
  - [ ] Client connected
  - [ ] ASR inference started / completed
- [ ] 客户端能把识别结果输入到目标窗口

## 4. 日志落盘（可选）

客户端：
- [ ] 设置 `GHOSTTYPE_LOG_FILE=1` 后，客户端日志写入：
  - [ ] `<客户端 exe 目录>/logs/ghosttype_client.log`
- [ ] 日志文件过大时会自动轮转（生成带时间戳的历史文件）

服务端（如需要）：
- [ ] 设置 `GHOSTTYPE_LOG_FILE=1` 后，服务端写入 `logs/ghosttype_YYYY-MM-DD.log`（由 loguru 轮转）

## 5. 记录与签字

- 测试人：_______________
- 日期：_______________
- Windows 版本：_______________
- 结果：[ ] 通过  [ ] 需要修复

