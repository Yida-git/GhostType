# GhostType Server（Windows）使用指南

本文面向最终用户与运维同学，说明如何在 Windows 上运行 GhostType Server（已打包可执行文件），以及常见故障排查方法。

## 1. 系统要求

- Windows 10 / 11（64 位）
- 网络：客户端需要能访问服务端端口（默认 `8000`）
- 显卡（可选但推荐）：支持 DirectML 的驱动环境（影响 ASR 性能）

## 2. 安装与启动

### 2.1 解压目录

将发布包解压到一个你有写权限的位置，例如：

- `D:\GhostType-Server\`

建议避免安装到 `C:\Program Files\`（可能导致写日志/缓存时权限不足）。

### 2.2 放置模型文件（必须）

将 ASR 模型文件放到：

- `models\sensevoice-small.onnx`

若缺少该文件，程序会弹窗提示并退出。

> 截图位置预留：这里放“models 目录结构”截图

### 2.3 启动

双击运行：

- `GhostTypeServer.exe`

启动后会出现托盘图标（系统右下角）。右键托盘图标可打开日志窗口或退出服务。

## 3. 防火墙配置

首次运行时，Windows 防火墙可能弹出提示。建议：

- 允许 `GhostTypeServer.exe` 在“专用网络（Private）”下通信
- 如果你在局域网内让其他设备连接，也可能需要允许“公用网络（Public）”（按你的安全策略选择）

如需手工放行：

1) 打开“Windows 安全中心” → “防火墙和网络保护”
2) “允许应用通过防火墙”
3) 添加并勾选 `GhostTypeServer.exe`

## 4. 托盘状态说明

托盘图标颜色代表服务状态（由日志状态机驱动）：

- 灰色：空闲（无客户端连接）
- 绿色：已连接（至少 1 个客户端）
- 蓝色：处理中（ASR 推理中）
- 红色：错误（服务进程退出或发生关键错误）

## 5. 故障排查

### 5.1 缺少模型文件

症状：启动弹窗提示缺少 `sensevoice-small.onnx`。

处理：

- 确认文件名与路径为 `models\sensevoice-small.onnx`
- 确认文件大小合理（过小可能是下载不完整）

### 5.2 端口占用（8000）

症状：启动后客户端无法连接或服务启动即退出。

检查：

```bat
netstat -ano | findstr :8000
```

处理建议：

- 关闭占用端口的进程，或后续通过命令行参数调整端口（如 `--port 8001`）

### 5.3 杀毒/安全软件误报

PyInstaller 打包的可执行文件在部分环境可能被误报拦截。

处理建议：

- 将解压目录加入白名单后再运行
- 在“纯净 Windows 环境”复测，确认没有真实恶意行为

### 5.4 无日志/看不到输出

默认通过托盘菜单打开日志窗口查看。

如需输出更多信息：

- 设置环境变量 `GHOSTTYPE_LOG=INFO`（或 `DEBUG`）后启动
- 如需写入文件日志，可设置 `GHOSTTYPE_LOG_FILE=1`（会在运行目录生成 `logs/`）

## 6. 从源码打包（开发者）

在 Windows 上执行一键打包脚本：

```bat
build\windows\build.bat
```

成功后输出目录：

- `releases\windows\GhostType-Server\`

> 截图位置预留：这里放“build.bat 输出成功”截图

